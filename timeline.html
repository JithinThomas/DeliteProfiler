<!DOCTYPE html>
<html>
	<head>
		<meta http-equiv="Content-Type" content="text/html;charset=utf-8">
		<title>Delite timeline view</title>
		<script type="text/javascript" src="http://mbostock.github.com/d3/d3.v2.js"></script>
		<style type="text/css">
		html,body
		{
		  height: 100%;
		  margin: 0;
		  padding: 0;
		  overflow-y:hidden;
		}
		.chart {
			shape-rendering: crispEdges;
		}

		.mini text {
			font: 9px sans-serif;	
		}

		.main text {
			font: 12px sans-serif;	
		}

		.miniItem0 {
			fill: orange;
			stroke-width: 6;	
		}

		.miniItem1 {
			fill: green;
			fill-opacity: .7;
			stroke-width: 6;	
		}

		.miniItem2 {
			fill: lightskyblue;
			fill-opacity: .7;
			stroke-width: 6;	
		}

		.brush .extent {
			stroke: gray;
			fill: dodgerblue;
			fill-opacity: .365;
		}

		.tooltip {
		    position: absolute;
		    text-align: left;
		    width: 100px;
		    color:white;
		    padding: 10px;
		    font: 8px sans-serif;
		    background: lightslategray;
		    pointer-events: none;
		    border-collapse: collapse;
		}
		.tooltipValue {
		    border:1px solid black;
		}
		</style>
	</head>
	<body>
		<script type="text/javascript" src="kernel-tooltip-1	.js"></script>
		<script type="text/javascript">
		//data
		var lanes = ["T1","T2","T3"],
			numLanes = lanes.length,
			items = [{"lane": 0, "id": "x1", "start": 5, "end": 205},
					{"lane": 0, "id": "x2", "start": 265, "end": 420},
					{"lane": 0, "id": "x3", "start": 580, "end": 615},
					{"lane": 0, "id": "x4", "start": 620, "end": 900},
					{"lane": 0, "id": "x5", "start": 960, "end": 1265},
					{"lane": 0, "id": "x6", "start": 1270, "end": 1365},
					{"lane": 0, "id": "x7", "start": 1370, "end": 1640},
					{"lane": 0, "id": "x8", "start": 1645, "end": 1910},
					{"lane": 1, "id": "x9", "start": 300, "end": 530},
					{"lane": 1, "id": "x10", "start": 550, "end": 700},
					{"lane": 1, "id": "x11", "start": 710, "end": 790},
					{"lane": 1, "id": "x12", "start": 800, "end": 1180},
					{"lane": 1, "id": "x13", "start": 1190, "end": 1330},
					{"lane": 1, "id": "x14", "start": 1340, "end": 1560},
					{"lane": 1, "id": "x15", "start": 1610, "end": 1860},
					{"lane": 1, "id": "x16", "start": 1870, "end": 1900},
					{"lane": 1, "id": "x17", "start": 1910, "end": 1920},
					{"lane": 1, "id": "x18", "start": 1925, "end": 1985},
					{"lane": 1, "id": "x19", "start": 1990, "end": 1995},
					{"lane": 2, "id": "x20", "start": 10, "end": 670},
					{"lane": 2, "id": "x21", "start": 690, "end": 900},
					{"lane": 2, "id": "x22", "start": 920, "end": 1380},
					{"lane": 2, "id": "x23", "start": 1390, "end": 1890},
					{"lane": 2, "id": "x24", "start": 1900, "end": 1945}]
			timeBegin = 0,
			timeEnd = 2000;
		</script>
		<script type="text/javascript" src="../jquery/dist/jquery.min.js"></script>
		<script type="text/javascript" src="../context-menu-js/jquery.contextMenu.js"></script>
		<script type="text/javascript">
		var m = [20, 15, 15, 120], //top right bottom left
			chartHeight = window.innerHeight - m[0] - m[2]
			chartWidth = window.innerWidth;

		//scales
		var x = d3.scale.linear()
				.domain([timeBegin, timeEnd + 50])
				.range([m[3], chartWidth - m[1]]);
		var y = d3.scale.linear()
				.domain([0, numLanes])
				.range([0, chartHeight]);

		var div1 = d3.select("body")
					.append("div")
					.attr("width", "20%")
					.attr("height", "100%")
					.attr("float", "left")

		var div2 = d3.select("body")
					.append("div")
					.attr("width", "80%")
					.attr("height", "100%")
					.attr("float", "right")

		//var chart = d3.select("body")
		var chart = div2
					.append("svg")
					.attr("width", chartWidth)
					.attr("height", chartHeight)
					.attr("class", "chart");

		var timelineGraph = chart.append("g")
					.attr("transform", "translate(" + m[3] + ",0")
					.attr("width", chartWidth)
					.attr("height", chartHeight)
					.attr("class", "mini");

		var rectHeight = 20;

		//timeline lanes and texts
		timelineGraph.append("g").selectAll(".laneLines")
			.data(items)
			.enter().append("line")
			.attr("x1", m[3])
			.attr("y1", function(d) {return y(d.lane + 0.5);})
			.attr("x2", chartWidth)
			.attr("y2", function(d) {return y(d.lane + 0.5);})
			.on("mouseover", mouseover)
			.on("mouseout", mouseout)
			.on("mousemove", mousemove)
			.attr("stroke", "lightgray");

		timelineGraph.append("g").selectAll(".laneText")
			.data(lanes)
			.enter().append("text")
			.text(function(d) {return d;})
			.attr("x", m[3] - 60)
			.attr("y", function(d, i) {return y(i + .5);})
			.attr("dy", ".5ex")
			.attr("text-anchor", "end")
			.attr("class", "laneText");
		
		//timline item rects
		timelineGraph.append("g").selectAll("miniItems")
			.data(items)
			.enter().append("rect")
			.attr("class", function(d) {return "miniItem" + d.lane;})
			.attr("x", function(d) {return x(d.start);})
			.attr("y", function(d) {return y(d.lane + .5) - rectHeight/2;})
			.attr("width", function(d) {return x(d.end) - x(d.start);})
			.attr("height", rectHeight)
			.on("mouseover", mouseover)
			.on("mouseout", mouseout)
			.on("mousemove", mousemove)
			.on("contextmenu", function(data, index) {
			    console.log("ContextMenu event fired!!")
			    d3.event.preventDefault();
			});

		//timeline labels
		var minDurationReqForDisplayingLabel = 30
		var eventsWithLabel = items.filter(function(d) {return (d.end - d.start) >= minDurationReqForDisplayingLabel})
		timelineGraph.append("g").selectAll(".miniLabels")
			.data(eventsWithLabel)
			.enter().append("text")
			.text(function(d) {return d.id;})
			.attr("x", function(d) {return (x(d.start) + x(d.end))/2;})
			.attr("y", function(d) {return y(d.lane + .5);})
			.attr("dy", ".5ex")
			.on("mouseover", mouseover)
			.on("mouseout", mouseout)
			.on("mousemove", mousemove)
			.attr("text-anchor", "middle");

		//=================================
		// Context-menu for right-click
		//=================================
		// The context-menu library was obtained from https://github.com/arnklint/jquery-contextMenu
		$(".miniItem0").contextMenu('context-menu-1', {
		    'Context Menu Item 1': {
		        click: function(element){  // element is the jquery obj clicked on when context menu launched
		            alert('Menu item 1 clicked');
		            element.css({fill: 'red'}); // just as example the clicked items backgorund is changed
		        },
		        klass: "custom-class1" // a custom css class for this menu item (usable for styling)
		    },
		    'Second menu item': {
		        click: function(element){ alert('second clicked'); },
		        klass: "custom-class2"
		    }
		  },
		  {
		  	/*
		    delegateEventTo: 'childrenSelector',
		    disable_native_context_menu: true,
		    showMenu: function() { alert("Showing menu"); },
		    hideMenu: function() { alert("Hiding menu"); },
		    leftClick: true // trigger on left click instead of right click
		    */
		  }
		);
		</script>
	</body>
</html>